<!DOCTYPE html>
<html lang="ru">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Банк Маннру</title>

  <!-- Styles -->
  <link rel="icon" type="image/x-icon" href="Icons/play_store_512.png" />
  <link href="https://fonts.googleapis.com/css2?family=Roboto:wght@400;500;700&display=swap" rel="stylesheet">
  <link href="https://fonts.googleapis.com/icon?family=Material+Symbols+Outlined" rel="stylesheet">
  <link rel="stylesheet" href="style.css">

  <!-- Material Web Components -->
  <link href="https://fonts.googleapis.com/css2?family=Roboto:wght@400;500;700&display=swap" rel="stylesheet">
    <script type="importmap">
      {
        "imports": {
          "@material/web/": "https://esm.run/@material/web/"
        }
      }
    </script>
    <script type="module">
      import '@material/web/all.js';
      import {styles as typescaleStyles} from '@material/web/typography/md-typescale-styles.js';
  
      document.adoptedStyleSheets.push(typescaleStyles.styleSheet);
    </script>

  <!-- Firebase -->
  <script src="https://www.gstatic.com/firebasejs/10.8.0/firebase-app.js" type="module"></script>
  <script src="https://www.gstatic.com/firebasejs/10.8.0/firebase-database.js" type="module"></script>
  <script src="https://www.gstatic.com/firebasejs/10.8.0/firebase-auth.js" type="module"></script>

  <!-- App Scripts -->
</head>
<body>
    <div id="promo-notification" style="display: none; position: fixed; top: 20px; left: 20px; background: rgba(165, 200, 255, 0.1); backdrop-filter: blur(10px); padding: 15px; border-radius: 10px; color: white; z-index: 1000;">
        <div style="display: flex; align-items: center; gap: 10px;">
            <md-icon>local_offer</md-icon>
            <span id="promo-text"></span>
        </div>
    </div>
    <div style="position: fixed; top: 20px; right: 20px;">
        <md-filled-button id="login-button">
            <md-icon slot="icon">credit_card</md-icon>
            Войти по карте
        </md-filled-button>
    </div>
    <div class='header' id="hiring-banner" style="display: none; align-items: center; justify-content: center;">Мы набираем работников для банк Маннру. 
        <a href="https://forms.gle/GJFTNofAoNCuxMT37" style="margin-left: 10px;">
            <md-filled-tonal-button>
                Подать заявку
                <svg slot="icon" viewBox="0 0 48 48"><path d="M6 40V8l38 16Zm3-4.65L36.2 24 9 12.5v8.4L21.1 24 9 27Zm0 0V12.5 27Z"/></svg>
              </md-filled-tonal-button>
        </a>
    </div>
    <div>
        <h1 class='head'>Добро пожаловать в банк Маннру!</h1>
        <h2 class='general-text'>
            Привет! Мы рады видеть вас в нашем банке. Чтобы начать пользоваться всеми преимуществами, пожалуйста, войдите в систему.<br>
            <br>
            Если у вас ещё нет карты, вы можете:<br>
            • Создать новую карту <a href="card_order.html" style="color: #a5c8ff;">здесь</a><br>
            • Посмотреть наши <a href="market.html" style="color: #a5c8ff;">специальные предложения</a><br>
            • Узнать больше о наших <a href="contacts.html" style="color: #a5c8ff;">услугах и контактах</a><br>
            <br>
            Преимущества банка Маннру:<br>
            • Удобное онлайн-управление картой<br>
            • Специальные предложения в нашем маркете<br>
            <br>
            <div class="calculator-section">
                <h3 style="color: #a5c8ff;">Калькулятор кэшбэка</h3>
                <div style="display: flex; gap: 10px; margin-top: 10px;">
                    <md-outlined-text-field
                        type="number"
                        label="Сумма покупки"
                        id="purchase-amount">
                    </md-outlined-text-field>
                    <md-filled-button id="calculate-cashback">
                        Рассчитать
                    </md-filled-button>
                </div>
                <div id="cashback-result" style="margin-top: 10px; color: #a5c8ff;"></div>
            </div>
            <div class="exchange-rate" style="margin-top: 20px;">
                <h3 style="color: #a5c8ff;">Курс МР</h3>
                <div id="exchange-rate" style="color: white; margin-top: 10px;">
                    Загрузка курса...
                </div>
            </div>
            <span style="color: #ffb4ab;">ВНИМАНИЕ!</span> Этот банк (почти) не предоставляет реальных банковских услуг - это демонстрационный проект. Но мы постоянно развиваемся и добавляем новые возможности!
            <br>
            Следите за обновлениями в нашей <a href="sitehistory.html" style="color: #a5c8ff;">истории изменений</a>.
        </h2>
    </div>

    <div class="useless-features">
        <h3 style="color: #a5c8ff;">Абсолютно бесполезные и никому ненужные функции</h3>
        <div style="display: flex; flex-wrap: wrap; gap: 16px; margin-top: 16px;">
            <!-- Калькулятор кэшбэка -->
            <md-outlined-button id="show-cashback-calc">
                <span slot="icon" class="material-symbols-outlined">calculate</span>
                Калькулятор кэшбэка
            </md-outlined-button>

            <!-- Курс МР -->
            <md-outlined-button id="show-exchange-rate">
                <span slot="icon" class="material-symbols-outlined">currency_exchange</span>
                Курс МР
            </md-outlined-button>

            <!-- Генератор отговорок -->
            <md-outlined-button id="excuse-generator">
                <span slot="icon" class="material-symbols-outlined">psychology</span>
                Генератор отговорок
            </md-outlined-button>

            <!-- Счётчик кликов -->
            <md-outlined-button id="click-counter">
                <span slot="icon" class="material-symbols-outlined">touch_app</span>
                Бесполезный счётчик
            </md-outlined-button>

            <!-- Предсказатель баланса -->
            <md-outlined-button id="balance-predictor">
                <span slot="icon" class="material-symbols-outlined">crystal_ball</span>
                Предсказать баланс
            </md-outlined-button>

            <!-- Генератор мотивации -->
            <md-outlined-button id="motivation-generator">
                <span slot="icon" class="material-symbols-outlined">self_improvement</span>
                Мотивация
            </md-outlined-button>

            <!-- Генератор банковских шуток -->
            <md-outlined-button id="bank-jokes">
                <span slot="icon" class="material-symbols-outlined">sentiment_very_satisfied</span>
                Банковские шутки
            </md-outlined-button>

            <!-- Случайный факт о деньгах -->
            <md-outlined-button id="money-facts">
                <span slot="icon" class="material-symbols-outlined">psychology_alt</span>
                Факты о деньгах
            </md-outlined-button>

            <!-- Генератор имён для карты -->
            <md-outlined-button id="card-name-generator">
                <span slot="icon" class="material-symbols-outlined">badge</span>
                Придумать имя карте
            </md-outlined-button>

            <!-- Симулятор потери денег -->
            <md-outlined-button id="money-loss-simulator">
                <span slot="icon" class="material-symbols-outlined">trending_down</span>
                Симулятор потерь
            </md-outlined-button>

            <!-- Калькулятор бесполезных расчётов -->
            <md-outlined-button id="useless-calculator">
                <span slot="icon" class="material-symbols-outlined">calculate</span>
                Странный калькулятор
            </md-outlined-button>

            <!-- Генератор финансовых советов -->
            <md-outlined-button id="finance-advice">
                <span slot="icon" class="material-symbols-outlined">lightbulb</span>
                Сомнительные советы
            </md-outlined-button>
        </div>
    </div>

    <div style="position: fixed; bottom: 20px; right: 20px; display: flex; gap: 10px;">
        <md-filled-icon-button onclick="window.location.href='index.html';">
          <md-icon><svg xmlns="http://www.w3.org/2000/svg" height="24px" viewBox="0 -960 960 960" width="24px" fill="#FFFFFF"><path d="M240-200h120v-240h240v240h120v-360L480-740 240-560v360Zm-80 80v-480l320-240 320 240v480H520v-240h-80v240H160Zm320-350Z"/></svg></md-icon>
        </md-filled-icon-button>
        <md-filled-icon-button onclick="window.location.href='market.html';">
          <md-icon><svg xmlns="http://www.w3.org/2000/svg" height="24px" viewBox="0 -960 960 960" width="24px" fill="#FFFFFF"><path d="M160-720v-80h640v80H160Zm0 560v-240h-40v-80l40-200h640l40 200v80h-40v240h-80v-240H560v240H160Zm80-80h240v-160H240v160Zm-38-240h556-556Zm0 0h556l-24-120H226l-24 120Z"/></svg></md-icon>
        </md-filled-icon-button>
        <md-filled-icon-button onclick="window.location.href='sitehistory.html';">
          <md-icon><svg xmlns="http://www.w3.org/2000/svg" height="24px" viewBox="0 -960 960 960" width="24px" fill="#FFFFFF"><path d="M480-120q-138 0-240.5-91.5T122-440h82q14 104 92.5 172T480-200q117 0 198.5-81.5T760-480q0-117-81.5-198.5T480-760q-69 0-129 32t-101 88h110v80H120v-240h80v94q51-64 124.5-99T480-840q75 0 140.5 28.5t114 77q48.5 48.5 77 114T840-480q0 75-28.5 140.5t-77 114q-48.5 48.5-114 77T480-120Zm112-192L440-464v-216h80v184l128 128-56 56Z"/></md-icon>
        </md-filled-icon-button>
        <md-filled-icon-button onclick="window.location.href='contacts.html';">
          <md-icon><svg xmlns="http://www.w3.org/2000/svg" height="24px" viewBox="0 -960 960 960" width="24px" fill="#FFFFFF"><path d="M480-400q33 0 56.5-23.5T560-480q0-33-23.5-56.5T480-560q-33 0-56.5 23.5T400-480q0 33 23.5 56.5T480-400ZM320-240h320v-23q0-24-13-44t-36-30q-26-11-53.5-17t-57.5-6q-30 0-57.5 6T369-337q-23 10-36 30t-13 44v23ZM720-80H240q-33 0-56.5-23.5T160-160v-640q0-33 23.5-56.5T240-880h320l240 240v480q0 33-23.5 56.5T720-80Zm0-80v-446L526-800H240v640h480Zm-480 0v-640 640Z"/></md-icon>
        </md-filled-icon-button>
    <script src="executor.js"></script>
    <script>
        // Theme handling function
        function applyTheme(theme) {
            if (theme === 'dark') {
                document.body.classList.add('dark-theme');
                document.body.classList.remove('light-theme');
            } else {
                document.body.classList.add('light-theme');
                document.body.classList.remove('dark-theme');
            }
        }

        // Apply theme on load
        document.addEventListener('DOMContentLoaded', () => {
            applyTheme(localStorage.getItem('theme') || 'default');
        });

        // Быстрые уведомления
        function showQuickNotification(message) {
            const notification = document.createElement('div');
            notification.className = 'quick-notification';
            notification.innerHTML = message;
            document.body.appendChild(notification);
            setTimeout(() => notification.remove(), 3000);
        }

        // Проверка статуса сервера
        async function checkServerStatus() {
            try {
                const response = await fetch('https://bank-mannru2-default-rtdb.firebaseio.com/.json');
                if (response.ok) {
                    showQuickNotification('Сервер работает нормально');
                }
            } catch (error) {
                showQuickNotification('Проблемы с подключением к серверу');
            }
        }

        // Автоматическое обновление страницы при потере соединения
        window.addEventListener('offline', () => {
            showQuickNotification('Соединение потеряно. Переподключение...');
            setTimeout(() => window.location.reload(), 5000);
        });
    </script>
    <script type="module">
        import { showLoginDialog } from './auth.js';
        import { app, database, auth } from './firebase-config.js';
        import { ref, onValue } from 'https://www.gstatic.com/firebasejs/10.8.0/firebase-database.js';

        // Setup login button
        const loginButton = document.getElementById('login-button');
        loginButton.addEventListener('click', () => {
            const userId = localStorage.getItem('currentCardId');
            if (userId) {
                // Если пользователь уже вошел, перенаправляем на страницу аккаунта
                window.location.href = `account.html?id=${userId}`;
            } else {
                // Если пользователь не вошел, показываем диалог входа
            showLoginDialog();
            }
        });

        // Check if user is logged in
        const userId = localStorage.getItem('currentCardId');
        if (userId) {
            loginButton.innerHTML = `
                <md-icon slot="icon">account_circle</md-icon>
                Моя карта
            `;
        }

        // Проверяем состояние баннера в Firebase
        const hiringBannerRef = ref(database, 'settings/hiringBannerEnabled');
        onValue(hiringBannerRef, (snapshot) => {
            const bannerEnabled = snapshot.val();
            const banner = document.getElementById('hiring-banner');
            banner.style.display = bannerEnabled ? 'flex' : 'none';
        });
    </script>
    <script>
        document.getElementById('calculate-cashback').addEventListener('click', () => {
            const amount = parseFloat(document.getElementById('purchase-amount').value);
            if (!isNaN(amount)) {
                const regularCashback = amount * 0.02;
                const premiumCashback = amount * 0.05;
                
                document.getElementById('cashback-result').innerHTML = `
                    Обычный кэшбэк: ${regularCashback.toFixed(2)} МР<br>
                    Премиум кэшбэк: ${premiumCashback.toFixed(2)} МР
                `;
            }
        });
    </script>
    <script>
        // Функция для получения курса МР
        async function getExchangeRate() {
            try {
                const response = await fetch('https://bank-mannru2-default-rtdb.firebaseio.com/exchangeRate.json');
                const rate = await response.json();
                if (rate) {
                    document.getElementById('exchange-rate').innerHTML = `
                        1 МР = ${rate.RUB} ₽<br>
                        1 МР = ${rate.USD} $
                    `;
                }
            } catch (error) {
                document.getElementById('exchange-rate').textContent = 'Не удалось загрузить курс';
            }
        }

        // Обновляем курс каждые 5 минут
        getExchangeRate();
        setInterval(getExchangeRate, 300000);
    </script>
    <script>
        // Проверка новых акций
        async function checkPromos() {
            try {
                const response = await fetch('https://bank-mannru2-default-rtdb.firebaseio.com/promos.json');
                const promos = await response.json();
                
                if (promos) {
                    const lastSeenPromo = localStorage.getItem('lastSeenPromo');
                    const latestPromo = Object.values(promos).sort((a, b) => b.timestamp - a.timestamp)[0];
                    
                    if (!lastSeenPromo || latestPromo.timestamp > parseInt(lastSeenPromo)) {
                        document.getElementById('promo-text').textContent = latestPromo.message;
                        document.getElementById('promo-notification').style.display = 'block';
                        localStorage.setItem('lastSeenPromo', latestPromo.timestamp);
                        
                        setTimeout(() => {
                            document.getElementById('promo-notification').style.display = 'none';
                        }, 5000);
                    }
                }
            } catch (error) {
                console.error('Ошибка при проверке акций:', error);
            }
        }

        // Проверяем акции при загрузке и каждые 10 минут
        checkPromos();
        setInterval(checkPromos, 600000);
    </script>
    <script>
        // Показ/скрытие калькулятора кэшбэка
        document.getElementById('show-cashback-calc').addEventListener('click', () => {
            const calculator = document.querySelector('.calculator-section');
            calculator.style.display = calculator.style.display === 'none' ? 'block' : 'none';
        });

        // Показ/скрытие курса МР
        document.getElementById('show-exchange-rate').addEventListener('click', () => {
            const rate = document.querySelector('.exchange-rate');
            rate.style.display = rate.style.display === 'none' ? 'block' : 'none';
        });

        // Генератор отговорок
        document.getElementById('excuse-generator').addEventListener('click', () => {
            const excuses = [
                "Извините, мой кот случайно перевёл все деньги в МР",
                "Я бы заплатил, но забыл пароль от своей памяти",
                "Банкомат съел мою карту и не отдаёт",
                "У меня аллергия на переводы по четвергам",
                "Мой баланс ушёл на обед и не вернулся"
            ];
            showNotification(excuses[Math.floor(Math.random() * excuses.length)]);
        });

        // Счётчик кликов
        let clickCount = 0;
        document.getElementById('click-counter').addEventListener('click', () => {
            clickCount++;
            showNotification(`Вы кликнули ${clickCount} раз! Это абсолютно бесполезно!`);
            if (clickCount === 100) {
                showNotification("Поздравляем! Вы потратили своё время!", true);
            }
        });

        // Предсказатель баланса
        document.getElementById('balance-predictor').addEventListener('click', () => {
            const predictions = [
                "Скоро будет много МР! (или нет)",
                "Звёзды говорят, что ваш баланс... существует",
                "В следующем месяце вас ждёт круглая сумма (возможно, 0)",
                "Ваш баланс будет расти! (если пополнять)",
                "Финансовый гороскоп советует не тратить всё сразу"
            ];
            showNotification(predictions[Math.floor(Math.random() * predictions.length)]);
        });

        // Генератор мотивации
        document.getElementById('motivation-generator').addEventListener('click', () => {
            const motivations = [
                "Копить МР - это как копить на мечту, только мечта не нужна!",
                "Каждый МР - это шаг к... другому МР!",
                "Ваш банк верит в вас! (наверное)",
                "Вы лучший клиент банка! (как и все остальные)",
                "Продолжайте в том же духе! (в каком именно - неважно)"
            ];
            showNotification(motivations[Math.floor(Math.random() * motivations.length)]);
        });

        // Обновляем функцию showNotification
        function showNotification(message, isSpecial = false) {
            const notification = document.createElement('div');
            notification.className = `toast ${isSpecial ? 'special' : ''}`;
            notification.style.position = 'fixed';
            notification.style.bottom = '20px';
            notification.style.left = '50%';
            notification.style.transform = 'translateX(-50%)';
            notification.style.padding = '15px 20px';
            notification.style.borderRadius = '10px';
            notification.style.color = 'white';
            notification.style.zIndex = '1000';
            notification.style.textAlign = 'center';
            notification.style.display = 'flex';
            notification.style.alignItems = 'center';
            notification.style.gap = '8px';
            notification.innerHTML = `
                <md-icon>${isSpecial ? 'stars' : 'info'}</md-icon>
                <span style="font-family: 'Product Sans', sans-serif;">${message}</span>
            `;

            document.body.appendChild(notification);
            setTimeout(() => {
                notification.style.opacity = '0';
                notification.style.transform = 'translateX(-50%) translateY(100px)';
                setTimeout(() => notification.remove(), 300);
            }, 3000);
        }

        // Банковские шутки
        document.getElementById('bank-jokes').addEventListener('click', () => {
            const jokes = [
                "Почему банкомат не ходит в спортзал? Он и так кэш выдаёт!",
                "Что сказал банкир своей второй половинке? Ты - мой главный процент!",
                "Как называется любимый фильм банкира? Властелин колец... с процентами",
                "Почему банкиры хорошие фотографы? Они всегда следят за балансом!",
                "Какой самый любимый праздник у банкира? День вклада святого Депозита!"
            ];
            showNotification(jokes[Math.floor(Math.random() * jokes.length)]);
        });

        // Факты о деньгах
        document.getElementById('money-facts').addEventListener('click', () => {
            const facts = [
                "Первый банкомат был установлен в 1967 году в Лондоне",
                "Самая крупная купюра в истории - 100 квинтиллионов пенгё (Венгрия)",
                "В Японии есть банкоматы, которые стерилизуют деньги ультрафиолетом",
                "Первая кредитная карта была создана в 1950 году",
                "На американских долларах нет изображений женщин"
            ];
            showNotification(facts[Math.floor(Math.random() * facts.length)]);
        });

        // Генератор имён для карты
        document.getElementById('card-name-generator').addEventListener('click', () => {
            const prefixes = ["Super", "Mega", "Ultra", "Hyper", "Maximum"];
            const types = ["Premium", "Gold", "Platinum", "Diamond", "Elite"];
            const suffixes = ["Plus", "Pro", "Max", "Supreme", "Ultimate"];
            
            const name = `${prefixes[Math.floor(Math.random() * prefixes.length)]} ${
                types[Math.floor(Math.random() * types.length)]} ${
                suffixes[Math.floor(Math.random() * suffixes.length)]}`;
            showNotification(`Ваша карта теперь называется: ${name}`, true);
        });

        // Симулятор потери денег
        document.getElementById('money-loss-simulator').addEventListener('click', () => {
            const amounts = [100, 500, 1000, 5000, 10000];
            const reasons = [
                "на несуществующий кофе",
                "на виртуальные носки",
                "на воображаемую пиццу",
                "на цифровой воздух",
                "на коллекцию невидимых марок"
            ];
            const amount = amounts[Math.floor(Math.random() * amounts.length)];
            const reason = reasons[Math.floor(Math.random() * reasons.length)];
            showNotification(`Вы потратили ${amount} МР ${reason}`, true);
        });

        // Странный калькулятор
        document.getElementById('useless-calculator').addEventListener('click', () => {
            const num = Math.floor(Math.random() * 1000);
            const calculations = [
                `${num} МР = ${num * 0.5} улыбок`,
                `${num} МР = ${num * 2} виртуальных котиков`,
                `${num} МР = ${num / 3} цифровых пончиков`,
                `${num} МР = ${num * 4} воображаемых монет`,
                `${num} МР = бесконечность хорошего настроения`
            ];
            showNotification(calculations[Math.floor(Math.random() * calculations.length)]);
        });

        // Сомнительные финансовые советы
        document.getElementById('finance-advice').addEventListener('click', () => {
            const advice = [
                "Копите деньги в носках, но только в разных!",
                "Инвестируйте в воображаемую недвижимость на Марсе",
                "Покупайте акции компании по производству воздуха",
                "Храните сбережения под подушкой, но меняйте подушку каждый день",
                "Создайте свою криптовалюту, основанную на улыбках"
            ];
            showNotification(advice[Math.floor(Math.random() * advice.length)]);
        });
    </script>
    <style>
        body {
            font-family: 'Product Sans', sans-serif;
        }

        /* Стили для тостов */
        @keyframes toastSlideIn {
            from {
                transform: translateX(-50%) translateY(100px);
                opacity: 0;
            }
            to {
                transform: translateX(-50%) translateY(0);
                opacity: 1;
            }
        }

        @keyframes toastGlow {
            0%, 100% { box-shadow: 0 4px 12px rgba(165, 200, 255, 0.2); }
            50% { box-shadow: 0 4px 20px rgba(165, 200, 255, 0.4); }
        }

        .toast {
            animation: toastSlideIn 0.3s ease forwards, toastGlow 2s ease infinite;
            background: rgba(30, 30, 30, 0.95);
            backdrop-filter: blur(10px);
            border: 1px solid rgba(165, 200, 255, 0.1);
        }

        .toast.special {
            background: linear-gradient(45deg, rgba(255, 215, 0, 0.95), rgba(255, 165, 0, 0.95));
            animation: toastSlideIn 0.3s ease forwards, toastGlow 1s ease infinite;
        }

        .useless-features {
            background: rgba(30, 30, 30, 0.95);
            backdrop-filter: blur(10px);
            border: 1px solid rgba(165, 200, 255, 0.1);
            box-shadow: 0 4px 20px rgba(0, 0, 0, 0.2);
        }

        .useless-features md-outlined-button {
            --md-outlined-button-container-shape: 8px;
            --md-outlined-button-label-text-color: #a5c8ff;
            --md-outlined-button-outline-color: rgba(165, 200, 255, 0.3);
        }

        .useless-features md-outlined-button:hover {
            --md-outlined-button-hover-state-layer-color: rgba(165, 200, 255, 0.1);
        }
    </style>
</body>
</html>