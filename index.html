<!DOCTYPE html>
<html lang="ru">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Банк Маннру</title>

  <!-- Styles -->
  <link rel="icon" type="image/x-icon" href="Icons/play_store_512.png" />
  <link href="https://fonts.googleapis.com/css2?family=Roboto:wght@400;500;700&display=swap" rel="stylesheet">
  <link href="https://fonts.googleapis.com/icon?family=Material+Symbols+Outlined" rel="stylesheet">
  <link rel="stylesheet" href="style.css">

  <!-- Material Web Components -->
  <link href="https://fonts.googleapis.com/css2?family=Roboto:wght@400;500;700&display=swap" rel="stylesheet">
    <script type="importmap">
      {
        "imports": {
          "@material/web/": "https://esm.run/@material/web/"
        }
      }
    </script>
    <script type="module">
      import '@material/web/all.js';
      import {styles as typescaleStyles} from '@material/web/typography/md-typescale-styles.js';
  
      document.adoptedStyleSheets.push(typescaleStyles.styleSheet);
    </script>

  <!-- Firebase -->
  <script src="https://www.gstatic.com/firebasejs/10.8.0/firebase-app.js" type="module"></script>
  <script src="https://www.gstatic.com/firebasejs/10.8.0/firebase-database.js" type="module"></script>
  <script src="https://www.gstatic.com/firebasejs/10.8.0/firebase-auth.js" type="module"></script>

  <!-- App Scripts -->
</head>
<body>
    <div id="promo-notification" style="display: none; position: fixed; top: 20px; left: 20px; background: rgba(165, 200, 255, 0.1); backdrop-filter: blur(10px); padding: 15px; border-radius: 10px; color: white; z-index: 1000;">
        <div style="display: flex; align-items: center; gap: 10px;">
            <md-icon>local_offer</md-icon>
            <span id="promo-text"></span>
        </div>
    </div>
    <div style="position: fixed; top: 20px; right: 20px;">
        <md-filled-button id="login-button">
            <md-icon slot="icon">credit_card</md-icon>
            Войти по карте
        </md-filled-button>
    </div>
    <div class='header' id="hiring-banner" style="display: none; align-items: center; justify-content: center;">Мы набираем работников для банк Маннру. 
        <a href="https://forms.gle/GJFTNofAoNCuxMT37" style="margin-left: 10px;">
            <md-filled-tonal-button>
                Подать заявку
                <svg slot="icon" viewBox="0 0 48 48"><path d="M6 40V8l38 16Zm3-4.65L36.2 24 9 12.5v8.4L21.1 24 9 27Zm0 0V12.5 27Z"/></svg>
              </md-filled-tonal-button>
        </a>
    </div>
    <div>
        <h1 class='head'>Добро пожаловать в банк Маннру!</h1>
        <h2 class='general-text'>
            Привет! Мы рады видеть вас в нашем банке. Чтобы начать пользоваться всеми преимуществами, пожалуйста, войдите в систему.<br>
            <br>
            Если у вас ещё нет карты, вы можете:<br>
            • Создать новую карту <a href="card_order.html" style="color: #a5c8ff;">здесь</a><br>
            • Посмотреть наши <a href="market.html" style="color: #a5c8ff;">специальные предложения</a><br>
            • Узнать больше о наших <a href="contacts.html" style="color: #a5c8ff;">услугах и контактах</a><br>
            <br>
            Преимущества банка Маннру:<br>
            • Удобное онлайн-управление картой<br>
            • Специальные предложения в нашем маркете<br>
            <br>

    <div style="position: fixed; bottom: 20px; right: 20px; display: flex; gap: 10px;">
        <md-filled-icon-button onclick="window.location.href='index.html';">
          <md-icon><svg xmlns="http://www.w3.org/2000/svg" height="24px" viewBox="0 -960 960 960" width="24px" fill="#FFFFFF"><path d="M240-200h120v-240h240v240h120v-360L480-740 240-560v360Zm-80 80v-480l320-240 320 240v480H520v-240h-80v240H160Zm320-350Z"/></svg></md-icon>
        </md-filled-icon-button>
        <md-filled-icon-button onclick="window.location.href='market.html';">
          <md-icon><svg xmlns="http://www.w3.org/2000/svg" height="24px" viewBox="0 -960 960 960" width="24px" fill="#FFFFFF"><path d="M160-720v-80h640v80H160Zm0 560v-240h-40v-80l40-200h640l40 200v80h-40v240h-80v-240H560v240H160Zm80-80h240v-160H240v160Zm-38-240h556-556Zm0 0h556l-24-120H226l-24 120Z"/></svg></md-icon>
        </md-filled-icon-button>
        <md-filled-icon-button onclick="window.location.href='sitehistory.html';">
          <md-icon><svg xmlns="http://www.w3.org/2000/svg" height="24px" viewBox="0 -960 960 960" width="24px" fill="#FFFFFF"><path d="M480-120q-138 0-240.5-91.5T122-440h82q14 104 92.5 172T480-200q117 0 198.5-81.5T760-480q0-117-81.5-198.5T480-760q-69 0-129 32t-101 88h110v80H120v-240h80v94q51-64 124.5-99T480-840q75 0 140.5 28.5t114 77q48.5 48.5 77 114T840-480q0 75-28.5 140.5t-77 114q-48.5 48.5-114 77T480-120Zm112-192L440-464v-216h80v184l128 128-56 56Z"/></md-icon>
        </md-filled-icon-button>
        <md-filled-icon-button onclick="window.location.href='contacts.html';">
          <md-icon><svg xmlns="http://www.w3.org/2000/svg" height="24px" viewBox="0 -960 960 960" width="24px" fill="#FFFFFF"><path d="M480-400q33 0 56.5-23.5T560-480q0-33-23.5-56.5T480-560q-33 0-56.5 23.5T400-480q0 33 23.5 56.5T480-400ZM320-240h320v-23q0-24-13-44t-36-30q-26-11-53.5-17t-57.5-6q-30 0-57.5 6T369-337q-23 10-36 30t-13 44v23ZM720-80H240q-33 0-56.5-23.5T160-160v-640q0-33 23.5-56.5T240-880h320l240 240v480q0 33-23.5 56.5T720-80Zm0-80v-446L526-800H240v640h480Zm-480 0v-640 640Z"/></md-icon>
        </md-filled-icon-button>
    <script src="executor.js"></script>
    <script>
        // Theme handling function
        function applyTheme(theme) {
            if (theme === 'dark') {
                document.body.classList.add('dark-theme');
                document.body.classList.remove('light-theme');
            } else {
                document.body.classList.add('light-theme');
                document.body.classList.remove('dark-theme');
            }
        }

        // Apply theme on load
        document.addEventListener('DOMContentLoaded', () => {
            applyTheme(localStorage.getItem('theme') || 'default');
        });

        // Быстрые уведомления
        function showQuickNotification(message) {
            const notification = document.createElement('div');
            notification.className = 'quick-notification';
            notification.innerHTML = message;
            document.body.appendChild(notification);
            setTimeout(() => notification.remove(), 3000);
        }

        // Проверка статуса сервера
        async function checkServerStatus() {
            try {
                const response = await fetch('https://bank-mannru2-default-rtdb.firebaseio.com/.json');
                if (response.ok) {
                    showQuickNotification('Сервер работает нормально');
                }
            } catch (error) {
                showQuickNotification('Проблемы с подключением к серверу');
            }
        }

        // Автоматическое обновление страницы при потере соединения
        window.addEventListener('offline', () => {
            showQuickNotification('Соединение потеряно. Переподключение...');
            setTimeout(() => window.location.reload(), 5000);
        });
    </script>
    <script type="module">
        import { showLoginDialog } from './auth.js';
        import { app, database, auth } from './firebase-config.js';
        import { ref, onValue } from 'https://www.gstatic.com/firebasejs/10.8.0/firebase-database.js';

        // Setup login button
        const loginButton = document.getElementById('login-button');
        loginButton.addEventListener('click', () => {
            const userId = localStorage.getItem('currentCardId');
            if (userId) {
                // Если пользователь уже вошел, перенаправляем на страницу аккаунта
                window.location.href = `account.html?id=${userId}`;
            } else {
                // Если пользователь не вошел, показываем диалог входа
            showLoginDialog();
            }
        });

        // Check if user is logged in
        const userId = localStorage.getItem('currentCardId');
        if (userId) {
            loginButton.innerHTML = `
                <md-icon slot="icon">account_circle</md-icon>
                Моя карта
            `;
        }

        // Проверяем состояние баннера в Firebase
        const hiringBannerRef = ref(database, 'settings/hiringBannerEnabled');
        onValue(hiringBannerRef, (snapshot) => {
            const bannerEnabled = snapshot.val();
            const banner = document.getElementById('hiring-banner');
            banner.style.display = bannerEnabled ? 'flex' : 'none';
        });
    </script>
    <script>
        document.getElementById('calculate-cashback').addEventListener('click', () => {
            const amount = parseFloat(document.getElementById('purchase-amount').value);
            if (!isNaN(amount)) {
                const regularCashback = amount * 0.02;
                const premiumCashback = amount * 0.05;
                
                document.getElementById('cashback-result').innerHTML = `
                    Обычный кэшбэк: ${regularCashback.toFixed(2)} МР<br>
                    Премиум кэшбэк: ${premiumCashback.toFixed(2)} МР
                `;
            }
        });
    </script>
    <script>
        // Функция для получения курса МР
        async function getExchangeRate() {
            try {
                const response = await fetch('https://bank-mannru2-default-rtdb.firebaseio.com/exchangeRate.json');
                const rate = await response.json();
                if (rate) {
                    document.getElementById('exchange-rate').innerHTML = `
                        1 МР = ${rate.RUB} ₽<br>
                        1 МР = ${rate.USD} $
                    `;
                }
            } catch (error) {
                document.getElementById('exchange-rate').textContent = 'Не удалось загрузить курс';
            }
        }

        // Обновляем курс каждые 5 минут
        getExchangeRate();
        setInterval(getExchangeRate, 300000);
    </script>
    <script>
        // Проверка новых акций
        async function checkPromos() {
            try {
                const response = await fetch('https://bank-mannru2-default-rtdb.firebaseio.com/promos.json');
                const promos = await response.json();
                
                if (promos) {
                    const lastSeenPromo = localStorage.getItem('lastSeenPromo');
                    const latestPromo = Object.values(promos).sort((a, b) => b.timestamp - a.timestamp)[0];
                    
                    if (!lastSeenPromo || latestPromo.timestamp > parseInt(lastSeenPromo)) {
                        document.getElementById('promo-text').textContent = latestPromo.message;
                        document.getElementById('promo-notification').style.display = 'block';
                        localStorage.setItem('lastSeenPromo', latestPromo.timestamp);
                        
                        setTimeout(() => {
                            document.getElementById('promo-notification').style.display = 'none';
                        }, 5000);
                    }
                }
            } catch (error) {
                console.error('Ошибка при проверке акций:', error);
            }
        }

        // Проверяем акции при загрузке и каждые 10 минут
        checkPromos();
        setInterval(checkPromos, 600000);
    </script>
    <style>
        body {
            font-family: 'Product Sans', sans-serif;
        }

        /* Стили для тостов */
        @keyframes toastSlideIn {
            from {
                transform: translateX(-50%) translateY(100px);
                opacity: 0;
            }
            to {
                transform: translateX(-50%) translateY(0);
                opacity: 1;
            }
        }

        @keyframes toastGlow {
            0%, 100% { box-shadow: 0 4px 12px rgba(165, 200, 255, 0.2); }
            50% { box-shadow: 0 4px 20px rgba(165, 200, 255, 0.4); }
        }

        .toast {
            animation: toastSlideIn 0.3s ease forwards, toastGlow 2s ease infinite;
            background: rgba(30, 30, 30, 0.95);
            backdrop-filter: blur(10px);
            border: 1px solid rgba(165, 200, 255, 0.1);
        }

        .toast.special {
            background: linear-gradient(45deg, rgba(255, 215, 0, 0.95), rgba(255, 165, 0, 0.95));
            animation: toastSlideIn 0.3s ease forwards, toastGlow 1s ease infinite;
        }
    </style>
</body>
</html>