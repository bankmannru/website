<<<<<<< HEAD
<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>–ü–∞–º—è—Ç—å - –ë–∞–Ω–∫ –ú–∞–Ω–Ω—Ä—É</title>
    <link href="https://fonts.googleapis.com/css2?family=Roboto:wght@400;500;700&display=swap" rel="stylesheet">
    <script type="importmap">
      {
        "imports": {
          "@material/web/": "https://esm.run/@material/web/"
        }
      }
    </script>
    <script type="module">
      import '@material/web/all.js';
      import { getDatabase, ref, get, update } from 'https://www.gstatic.com/firebasejs/10.8.0/firebase-database.js';
      import { database } from './firebase-config.js';

      const db = database;
      
      // –î–µ–ª–∞–µ–º —Ñ—É–Ω–∫—Ü–∏–∏ –¥–æ—Å—Ç—É–ø–Ω—ã–º–∏ –≥–ª–æ–±–∞–ª—å–Ω–æ
      window.startGame = startGame;
      window.flipCard = flipCard;
      window.gameWon = gameWon;

      // –ü–µ—Ä–µ–º–µ–Ω–Ω—ã–µ —Å–æ—Å—Ç–æ—è–Ω–∏—è
      window.gameState = {
          moves: 0,
          pairs: 0,
          timeElapsed: 0,
          timer: null,
          flippedCards: [],
          canFlip: true,
          cards: []
      };

      const emojis = ['üéÆ', 'üé≤', 'üéØ', 'üé™', 'üé®', 'üé≠', 'üé™', 'üéØ', 'üé≤', 'üéÆ', 'üé®', 'üé≠'];

      function startGame() {
          const state = window.gameState;
          state.moves = 0;
          state.pairs = 0;
          state.timeElapsed = 0;
          state.flippedCards = [];
          state.canFlip = true;
          
          document.getElementById('moves').textContent = state.moves;
          document.getElementById('pairs').textContent = state.pairs;
          document.getElementById('time').textContent = state.timeElapsed;

          clearInterval(state.timer);
          state.timer = setInterval(() => {
              state.timeElapsed++;
              document.getElementById('time').textContent = state.timeElapsed;
          }, 1000);

          // –ü–µ—Ä–µ–º–µ—à–∏–≤–∞–µ–º –∫–∞—Ä—Ç—ã
          state.cards = [...emojis].sort(() => Math.random() - 0.5);
          const gameGrid = document.getElementById('gameGrid');
          gameGrid.innerHTML = '';

          state.cards.forEach((emoji, index) => {
              const card = document.createElement('div');
              card.className = 'card';
              card.innerHTML = `
                  <div class="card-front"></div>
                  <div class="card-back">${emoji}</div>
              `;
              card.dataset.index = index;
              card.onclick = () => flipCard(card);
              gameGrid.appendChild(card);
          });
      }

      async function flipCard(card) {
          const state = window.gameState;
          if (!state.canFlip || card.classList.contains('flipped') || state.flippedCards.includes(card)) return;

          card.classList.add('flipped');
          state.flippedCards.push(card);
          state.moves++;
          document.getElementById('moves').textContent = state.moves;

          if (state.flippedCards.length === 2) {
              state.canFlip = false;
              const [card1, card2] = state.flippedCards;
              const match = state.cards[card1.dataset.index] === state.cards[card2.dataset.index];

              if (match) {
                  state.pairs++;
                  document.getElementById('pairs').textContent = state.pairs;
                  state.flippedCards = [];
                  state.canFlip = true;

                  if (state.pairs === 6) {
                      await gameWon();
                  }
              } else {
                  setTimeout(() => {
                      card1.classList.remove('flipped');
                      card2.classList.remove('flipped');
                      state.flippedCards = [];
                      state.canFlip = true;
                  }, 1000);
              }
          }
      }

      async function gameWon() {
          const state = window.gameState;
          clearInterval(state.timer);
          const reward = Math.max(100, 1000 - (state.moves * 10 + state.timeElapsed * 5));
          
          const urlParams = new URLSearchParams(window.location.search);
          const cardId = urlParams.get('cardId');
          
          if (!cardId) {
              alert('–ü–æ–∂–∞–ª—É–π—Å—Ç–∞, –≤–æ–π–¥–∏—Ç–µ –≤ –∞–∫–∫–∞—É–Ω—Ç, —á—Ç–æ–±—ã –ø–æ–ª—É—á–∏—Ç—å –Ω–∞–≥—Ä–∞–¥—É!');
              return;
          }
          
          if (reward > 0) {
              try {
                  const snapshot = await get(ref(db, `cards/${cardId}`));
                  const card = snapshot.val();
                  await update(ref(db), {
                      [`cards/${cardId}/balance`]: (card.balance || 0) + reward,
                      [`cards/${cardId}/transactions/${Date.now()}`]: {
                          type: 'game',
                          amount: reward,
                          description: `–í—ã–∏–≥—Ä—ã—à –≤ –∏–≥—Ä–µ "–ü–∞–º—è—Ç—å" (${state.moves} —Ö–æ–¥–æ–≤, ${state.timeElapsed}—Å)`,
                          timestamp: Date.now()
                      }
                  });
                  alert(`–ü–æ–∑–¥—Ä–∞–≤–ª—è–µ–º! –í—ã –≤—ã–∏–≥—Ä–∞–ª–∏ ${reward} –ú–†!\n–•–æ–¥—ã: ${state.moves}\n–í—Ä–µ–º—è: ${state.timeElapsed}—Å`);
              } catch (error) {
                  console.error('–û—à–∏–±–∫–∞ –ø—Ä–∏ —Å–æ—Ö—Ä–∞–Ω–µ–Ω–∏–∏ —Ä–µ–∑—É–ª—å—Ç–∞—Ç–∞:', error);
                  alert('–ü—Ä–æ–∏–∑–æ—à–ª–∞ –æ—à–∏–±–∫–∞ –ø—Ä–∏ —Å–æ—Ö—Ä–∞–Ω–µ–Ω–∏–∏ —Ä–µ–∑—É–ª—å—Ç–∞—Ç–∞. –ü–æ–∂–∞–ª—É–π—Å—Ç–∞, —É–±–µ–¥–∏—Ç–µ—Å—å, —á—Ç–æ –≤—ã –≤–æ—à–ª–∏ –≤ –∞–∫–∫–∞—É–Ω—Ç.');
              }
          }
      }

      // –ó–∞–ø—É—Å–∫–∞–µ–º –∏–≥—Ä—É –ø—Ä–∏ –∑–∞–≥—Ä—É–∑–∫–µ
      startGame();
    </script>
    <style>
        body {
            margin: 0;
            padding: 20px;
            min-height: 100vh;
            background: #1a1a1a;
            font-family: 'Roboto', sans-serif;
            color: white;
            overflow-x: hidden;
        }

        .container {
            max-width: 800px;
            margin: 0 auto;
            text-align: center;
            padding: 0 10px;
        }

        .game-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(70px, 1fr));
            gap: 10px;
            margin: 20px 0;
            max-width: 100%;
        }

        .card {
            aspect-ratio: 1;
            background: #2d2d2d;
            border-radius: 8px;
            cursor: pointer;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 24px;
            transition: transform 0.3s;
            transform-style: preserve-3d;
            touch-action: manipulation;
            -webkit-tap-highlight-color: transparent;
        }

        .card.flipped {
            transform: rotateY(180deg);
        }

        .card-front, .card-back {
            position: absolute;
            width: 100%;
            height: 100%;
            backface-visibility: hidden;
            display: flex;
            align-items: center;
            justify-content: center;
        }

        .card-back {
            background: #4CAF50;
            transform: rotateY(180deg);
        }

        .stats {
            display: flex;
            justify-content: space-around;
            margin: 20px 0;
            font-size: 18px;
            flex-wrap: wrap;
            gap: 10px;
        }

        @media (max-width: 480px) {
            body {
                padding: 10px;
            }

            h1 {
                font-size: 24px;
                margin: 10px 0;
            }

            .stats {
                font-size: 14px;
            }

            .card {
                font-size: 20px;
            }

            md-filled-button {
                width: 100%;
            }
        }
    </style>
</head>
<body>
    <div class="container">
        <h1>–ò–≥—Ä–∞ "–ü–∞–º—è—Ç—å"</h1>
        <div class="stats">
            <div>–•–æ–¥—ã: <span id="moves">0</span></div>
            <div>–ü–∞—Ä—ã: <span id="pairs">0</span>/8</div>
            <div>–í—Ä–µ–º—è: <span id="time">0</span>—Å</div>
        </div>
        <div class="game-grid" id="gameGrid"></div>
        <md-filled-button onclick="startGame()">–ù–æ–≤–∞—è –∏–≥—Ä–∞</md-filled-button>
    </div>
</body>
=======
<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>–ü–∞–º—è—Ç—å - –ë–∞–Ω–∫ –ú–∞–Ω–Ω—Ä—É</title>
    <link href="https://fonts.googleapis.com/css2?family=Roboto:wght@400;500;700&display=swap" rel="stylesheet">
    <script type="importmap">
      {
        "imports": {
          "@material/web/": "https://esm.run/@material/web/"
        }
      }
    </script>
    <script type="module">
      import '@material/web/all.js';
      import { getDatabase, ref, get, update } from 'https://www.gstatic.com/firebasejs/10.8.0/firebase-database.js';
      import { database } from './firebase-config.js';

      const db = database;
      
      // –î–µ–ª–∞–µ–º —Ñ—É–Ω–∫—Ü–∏–∏ –¥–æ—Å—Ç—É–ø–Ω—ã–º–∏ –≥–ª–æ–±–∞–ª—å–Ω–æ
      window.startGame = startGame;
      window.flipCard = flipCard;
      window.gameWon = gameWon;

      // –ü–µ—Ä–µ–º–µ–Ω–Ω—ã–µ —Å–æ—Å—Ç–æ—è–Ω–∏—è
      window.gameState = {
          moves: 0,
          pairs: 0,
          timeElapsed: 0,
          timer: null,
          flippedCards: [],
          canFlip: true,
          cards: []
      };

      const emojis = ['üéÆ', 'üé≤', 'üéØ', 'üé™', 'üé®', 'üé≠', 'üé™', 'üéØ', 'üé≤', 'üéÆ', 'üé®', 'üé≠'];

      function startGame() {
          const state = window.gameState;
          state.moves = 0;
          state.pairs = 0;
          state.timeElapsed = 0;
          state.flippedCards = [];
          state.canFlip = true;
          
          document.getElementById('moves').textContent = state.moves;
          document.getElementById('pairs').textContent = state.pairs;
          document.getElementById('time').textContent = state.timeElapsed;

          clearInterval(state.timer);
          state.timer = setInterval(() => {
              state.timeElapsed++;
              document.getElementById('time').textContent = state.timeElapsed;
          }, 1000);

          // –ü–µ—Ä–µ–º–µ—à–∏–≤–∞–µ–º –∫–∞—Ä—Ç—ã
          state.cards = [...emojis].sort(() => Math.random() - 0.5);
          const gameGrid = document.getElementById('gameGrid');
          gameGrid.innerHTML = '';

          state.cards.forEach((emoji, index) => {
              const card = document.createElement('div');
              card.className = 'card';
              card.innerHTML = `
                  <div class="card-front"></div>
                  <div class="card-back">${emoji}</div>
              `;
              card.dataset.index = index;
              card.onclick = () => flipCard(card);
              gameGrid.appendChild(card);
          });
      }

      async function flipCard(card) {
          const state = window.gameState;
          if (!state.canFlip || card.classList.contains('flipped') || state.flippedCards.includes(card)) return;

          card.classList.add('flipped');
          state.flippedCards.push(card);
          state.moves++;
          document.getElementById('moves').textContent = state.moves;

          if (state.flippedCards.length === 2) {
              state.canFlip = false;
              const [card1, card2] = state.flippedCards;
              const match = state.cards[card1.dataset.index] === state.cards[card2.dataset.index];

              if (match) {
                  state.pairs++;
                  document.getElementById('pairs').textContent = state.pairs;
                  state.flippedCards = [];
                  state.canFlip = true;

                  if (state.pairs === 6) {
                      await gameWon();
                  }
              } else {
                  setTimeout(() => {
                      card1.classList.remove('flipped');
                      card2.classList.remove('flipped');
                      state.flippedCards = [];
                      state.canFlip = true;
                  }, 1000);
              }
          }
      }

      async function gameWon() {
          const state = window.gameState;
          clearInterval(state.timer);
          const reward = Math.max(100, 1000 - (state.moves * 10 + state.timeElapsed * 5));
          
          const urlParams = new URLSearchParams(window.location.search);
          const cardId = urlParams.get('cardId');
          
          if (!cardId) {
              alert('–ü–æ–∂–∞–ª—É–π—Å—Ç–∞, –≤–æ–π–¥–∏—Ç–µ –≤ –∞–∫–∫–∞—É–Ω—Ç, —á—Ç–æ–±—ã –ø–æ–ª—É—á–∏—Ç—å –Ω–∞–≥—Ä–∞–¥—É!');
              return;
          }
          
          if (reward > 0) {
              try {
                  const snapshot = await get(ref(db, `cards/${cardId}`));
                  const card = snapshot.val();
                  await update(ref(db), {
                      [`cards/${cardId}/balance`]: (card.balance || 0) + reward,
                      [`cards/${cardId}/transactions/${Date.now()}`]: {
                          type: 'game',
                          amount: reward,
                          description: `–í—ã–∏–≥—Ä—ã—à –≤ –∏–≥—Ä–µ "–ü–∞–º—è—Ç—å" (${state.moves} —Ö–æ–¥–æ–≤, ${state.timeElapsed}—Å)`,
                          timestamp: Date.now()
                      }
                  });
                  alert(`–ü–æ–∑–¥—Ä–∞–≤–ª—è–µ–º! –í—ã –≤—ã–∏–≥—Ä–∞–ª–∏ ${reward} –ú–†!\n–•–æ–¥—ã: ${state.moves}\n–í—Ä–µ–º—è: ${state.timeElapsed}—Å`);
              } catch (error) {
                  console.error('–û—à–∏–±–∫–∞ –ø—Ä–∏ —Å–æ—Ö—Ä–∞–Ω–µ–Ω–∏–∏ —Ä–µ–∑—É–ª—å—Ç–∞—Ç–∞:', error);
                  alert('–ü—Ä–æ–∏–∑–æ—à–ª–∞ –æ—à–∏–±–∫–∞ –ø—Ä–∏ —Å–æ—Ö—Ä–∞–Ω–µ–Ω–∏–∏ —Ä–µ–∑—É–ª—å—Ç–∞—Ç–∞. –ü–æ–∂–∞–ª—É–π—Å—Ç–∞, —É–±–µ–¥–∏—Ç–µ—Å—å, —á—Ç–æ –≤—ã –≤–æ—à–ª–∏ –≤ –∞–∫–∫–∞—É–Ω—Ç.');
              }
          }
      }

      // –ó–∞–ø—É—Å–∫–∞–µ–º –∏–≥—Ä—É –ø—Ä–∏ –∑–∞–≥—Ä—É–∑–∫–µ
      startGame();
    </script>
    <style>
        body {
            margin: 0;
            padding: 20px;
            min-height: 100vh;
            background: #1a1a1a;
            font-family: 'Roboto', sans-serif;
            color: white;
            overflow-x: hidden;
        }

        .container {
            max-width: 800px;
            margin: 0 auto;
            text-align: center;
            padding: 0 10px;
        }

        .game-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(70px, 1fr));
            gap: 10px;
            margin: 20px 0;
            max-width: 100%;
        }

        .card {
            aspect-ratio: 1;
            background: #2d2d2d;
            border-radius: 8px;
            cursor: pointer;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 24px;
            transition: transform 0.3s;
            transform-style: preserve-3d;
            touch-action: manipulation;
            -webkit-tap-highlight-color: transparent;
        }

        .card.flipped {
            transform: rotateY(180deg);
        }

        .card-front, .card-back {
            position: absolute;
            width: 100%;
            height: 100%;
            backface-visibility: hidden;
            display: flex;
            align-items: center;
            justify-content: center;
        }

        .card-back {
            background: #4CAF50;
            transform: rotateY(180deg);
        }

        .stats {
            display: flex;
            justify-content: space-around;
            margin: 20px 0;
            font-size: 18px;
            flex-wrap: wrap;
            gap: 10px;
        }

        @media (max-width: 480px) {
            body {
                padding: 10px;
            }

            h1 {
                font-size: 24px;
                margin: 10px 0;
            }

            .stats {
                font-size: 14px;
            }

            .card {
                font-size: 20px;
            }

            md-filled-button {
                width: 100%;
            }
        }
    </style>
</head>
<body>
    <div class="container">
        <h1>–ò–≥—Ä–∞ "–ü–∞–º—è—Ç—å"</h1>
        <div class="stats">
            <div>–•–æ–¥—ã: <span id="moves">0</span></div>
            <div>–ü–∞—Ä—ã: <span id="pairs">0</span>/8</div>
            <div>–í—Ä–µ–º—è: <span id="time">0</span>—Å</div>
        </div>
        <div class="game-grid" id="gameGrid"></div>
        <md-filled-button onclick="startGame()">–ù–æ–≤–∞—è –∏–≥—Ä–∞</md-filled-button>
    </div>
</body>
>>>>>>> 58afe73bc799a44fad7f9cc6e3f1e7079ea65410
</html> 